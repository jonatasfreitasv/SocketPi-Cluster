global
    maxconn 4096
    nbproc 1

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms

listen haproxy 0.0.0.0:80
    stats enable
    stats hide-version
    stats realm   Haproxy\ Statistics
    stats uri /haproxy?stats

listen socketio-cluster
    bind *:843

      acl is_websocket path_beg /socket.io
      acl is_websocket hdr(Upgrade) -i WebSocket
      acl is_websocket hdr_beg(Host) -i ws

      use_backend socketio-cluster-nodes if is_websocket

backend socketio-cluster-nodes
    balance roundrobin

    timeout queue 5000
    timeout server 5000
    timeout connect 5000

    option httpchk HEAD /health
    http-check expect status 200

    server master localhost:8080        weight 1    maxconn 1024 check
    server node1  192.168.0.102:8080    weight 1    maxconn 1024 check
    server node2  192.168.0.103:8080    weight 1    maxconn 1024 check